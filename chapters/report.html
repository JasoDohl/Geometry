<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Teacher Report Card</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background: #f0f2f5; padding: 20px; }
        .report-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-width: 1000px;
            margin: 0 auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }
        th { background-color: #4285F4; color: white; }
        tr:hover { background-color: #f1f1f1; }
        .status-done { color: green; font-weight: bold; }
        .status-pending { color: #ccc; }
    </style>
</head>
<body>

    <div class="report-card">
        <h1>üìä Student Progress Report</h1>
        <p>Real-time view of student activity.</p>
        <button onclick="window.print()" style="margin-bottom: 20px; cursor: pointer;">üñ®Ô∏è Print Report</button>
        <a href="index.html" style="margin-left: 20px;">‚Üê Back Home</a>

        <table>
            <thead>
                <tr>
                    <th>Student Name</th>
                    <th>Email</th>
                    <th>Last Login</th>
                    <th>Triangles (Ch2)</th>
                    <th>Polygons (Ch5)</th>
                </tr>
            </thead>
            <tbody id="student-table">
                <tr><td colspan="5">Loading data...</td></tr>
            </tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // YOUR CONFIG (Same as always)
        const firebaseConfig = {
            apiKey: "AIzaSyBNRSYfjGERQOwJxtVkHWnk7z2o0SAvzFs",
            authDomain: "dohl-s-geometry.firebaseapp.com",
            projectId: "dohl-s-geometry",
            storageBucket: "dohl-s-geometry.firebasestorage.app",
            messagingSenderId: "92329448606",
            appId: "1:92329448606:web:dc62534a6c4c972b7f178f",
            measurementId: "G-2FHN2VX726"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function generateReport() {
            const tableBody = document.getElementById('student-table');
            tableBody.innerHTML = ''; // Clear loading message

            // Get all students, sorted by who logged in most recently
            const q = query(collection(db, "students"), orderBy("lastLogin", "desc"));
            const querySnapshot = await getDocs(q);

            querySnapshot.forEach((doc) => {
                const student = doc.data();
                
                // Convert Firestore Timestamp to readable date
                let lastSeen = "Never";
                if (student.lastLogin) {
                    lastSeen = new Date(student.lastLogin.seconds * 1000).toLocaleDateString();
                }

                // Check Progress (We look for specific fields we will create in Part 2)
                const ch2 = student.finished_triangles ? "‚úÖ Complete" : "‚Äî";
                const ch5 = student.finished_polygons ? "‚úÖ Complete" : "‚Äî";

                // Add Row to Table
                const row = `
                    <tr>
                        <td><strong>${student.name}</strong></td>
                        <td>${student.email}</td>
                        <td>${lastSeen}</td>
                        <td class="${student.finished_triangles ? 'status-done' : 'status-pending'}">${ch2}</td>
                        <td class="${student.finished_polygons ? 'status-done' : 'status-pending'}">${ch5}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        generateReport();
    </script>
</body>
</html>
